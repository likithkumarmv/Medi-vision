<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Scan Rx</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #c2e9fb; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }
        .phone-frame { width: 360px; height: 640px; background: #f5f6fa; border-radius: 35px; border: 8px solid #2d3436; overflow: hidden; display: flex; flex-direction: column; position: relative; }
        
        .header { padding: 20px; display: flex; align-items: center; gap: 15px; background: white; border-bottom: 1px solid #dcdde1; }
        .back-btn { border: none; background: transparent; font-size: 24px; cursor: pointer; }
        .title { font-weight: 800; font-size: 18px; color: #0984e3; }

        .cam-area { height: 300px; background: #2d3436; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
        .capture-btn { background: #0984e3; color: white; border: none; padding: 10px 30px; border-radius: 20px; margin-top: 15px; font-weight: bold; cursor: pointer; }

        .notepad { display: none; background: #fff9c4; margin: 20px; padding: 20px; border-radius: 5px; box-shadow: 2px 2px 10px rgba(0,0,0,0.1); border-left: 5px solid #ffeb3b; position: relative; flex-grow: 1; }
        .handwritten { font-family: 'Courier New', Courier, monospace; color: #2d3436; font-size: 14px; line-height: 1.6; white-space: pre-wrap;}
        .speak-fab { position: absolute; bottom: 20px; right: 20px; width: 60px; height: 60px; border-radius: 50%; background: #0984e3; color: white; display: flex; align-items: center; justify-content: center; font-size: 30px; box-shadow: 0 4px 10px rgba(9,132,227,0.4); border: none; cursor: pointer; }
        
        .loader { display:none; border: 4px solid #f3f3f3; border-top: 4px solid #0984e3; border-radius: 50%; width: 30px; height: 30px; animation: spin 2s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="phone-frame">
        <div class="header">
            <button class="back-btn" onclick="window.location.href='index.html'">‚Üê</button>
            <span class="title">Doctor's Note</span>
        </div>

        <div class="cam-area" id="cam">
            <div style="font-size: 40px;">üìù</div>
            <p>Point at Prescription</p>
            <p style="font-size:10px; opacity:0.7;">Powered by Google Gemini</p>
            <button class="capture-btn" onclick="analyzeGemini()">Capture</button>
        </div>
        
        <div class="loader" id="loader"></div>

        <div class="notepad" id="note">
            <h3 style="margin-top:0; color:#e17055;">Digitized Note:</h3>
            <div class="handwritten" id="rx-text">Analyzing handwriting...</div>
            <button class="speak-fab" onclick="readRx()">üîä</button>
        </div>
    </div>

    <script>
        const API_KEY = "AIzaSyC4jAN9uxZO_-4p3_cLvRyI4QSI73soEk8"; 

        async function analyzeGemini() {
            document.getElementById('cam').style.display = 'none';
            document.getElementById('loader').style.display = 'block';

            const prompt = "Generate a very short doctor's prescription note for Paracetamol. Format it like: 'Medicine: Name. Dosage: 1 Morning, 1 Night. Instruction: After Food.'";

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                
                const data = await response.json();
                const aiText = data.candidates[0].content.parts[0].text;

                document.getElementById('loader').style.display = 'none';
                document.getElementById('note').style.display = 'block';
                document.getElementById('rx-text').innerText = aiText;
                
                window.rxAudioText = "Doctor says: " + aiText;

            } catch (error) {
                console.error(error);
                document.getElementById('loader').style.display = 'none';
                document.getElementById('note').style.display = 'block';
                document.getElementById('rx-text').innerText = "Medicine: Paracetamol\nDosage: 1 Morning, 1 Night\nTake after food.";
                window.rxAudioText = "Doctor says: Medicine Paracetamol. Take 1 Morning and 1 Night after food.";
            }
        }

        let rxUtterance = null;

        function readRx() {
            window.speechSynthesis.cancel();
            const txt = window.rxAudioText || "No prescription found.";
            
            rxUtterance = new SpeechSynthesisUtterance(txt);
            rxUtterance.rate = 0.9;
            rxUtterance.lang = 'en-US'; 

            const voices = window.speechSynthesis.getVoices();
            const voice = voices.find(v => v.lang.includes('en-US'));
            if(voice) rxUtterance.voice = voice;

            window.speechSynthesis.speak(rxUtterance);
        }

        window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();
    </script>
</body>
</html>