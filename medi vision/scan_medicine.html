<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Scan Medicine</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #c2e9fb; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }
        .phone-frame { width: 360px; height: 640px; background: white; border-radius: 35px; border: 8px solid #2d3436; overflow: hidden; display: flex; flex-direction: column; position: relative; }
        
        .header { padding: 20px; display: flex; align-items: center; gap: 15px; font-weight: 800; font-size: 18px; color: #2d3436; z-index: 10; background: white; }
        .back-btn { border: none; background: #f1f2f6; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center; }

        .cam-container { position: relative; width: 100%; height: 350px; background: #000; overflow: hidden; display:flex; justify-content:center; align-items:center; color: white;}
        .laser { position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: #ff4757; box-shadow: 0 0 10px #ff4757; animation: scan 2s infinite; }
        @keyframes scan { 0% { top: 0; } 50% { top: 100%; } 100% { top: 0; } }

        .controls { padding: 20px; text-align: center; flex-grow: 1; background: white; border-top-left-radius: 20px; border-top-right-radius: 20px; margin-top: -20px; z-index: 5; position: relative; }
        .snap-btn { width: 70px; height: 70px; border-radius: 50%; border: 5px solid #dcdde1; background: white; display: inline-flex; justify-content: center; align-items: center; cursor: pointer; }
        .snap-inner { width: 50px; height: 50px; background: #ff4757; border-radius: 50%; transition:0.2s; }
        .snap-btn:active .snap-inner { transform: scale(0.8); }

        .result-modal { display: none; position: absolute; bottom: 0; left: 0; width: 100%; background: white; border-top-left-radius: 30px; border-top-right-radius: 30px; padding: 30px 20px; box-shadow: 0 -10px 30px rgba(0,0,0,0.1); box-sizing: border-box; z-index: 20; height: 50%; }
        
        .tag { background: #e3f2fd; color: #0984e3; padding: 5px 10px; border-radius: 5px; font-size: 12px; font-weight: bold; }
        .big-txt { font-size: 24px; font-weight: bold; color: #2d3436; margin: 10px 0; }
        .speak-btn { background: #0984e3; color: white; border: none; width: 100%; padding: 15px; border-radius: 15px; font-size: 16px; font-weight: bold; margin-top: 20px; cursor: pointer; }

        .loader { display:none; border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 2s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="phone-frame">
        <div class="header">
            <button class="back-btn" onclick="window.location.href='index.html'">‚Üê</button>
            <span>Scan Medicine</span>
        </div>

        <div class="cam-container" id="camera">
            <div class="laser"></div>
            <div style="text-align:center;">üì∑<br>Align Strip<br><span style="font-size:10px; opacity:0.7;">Gemini AI Active</span></div>
        </div>

        <div class="controls">
            <p style="color:#636e72; font-size:14px; margin-bottom:20px;">Place medicine inside the box</p>
            <div class="snap-btn" onclick="processWithGemini()">
                <div class="snap-inner"></div>
            </div>
        </div>

        <div class="result-modal" id="result">
            <div class="loader" id="ai-loader"></div>
            <div id="ai-content" style="display:none">
                <div class="tag">AI ANALYSIS</div>
                <div class="big-txt">Dolo 650</div>
                <p style="color: #636e72; font-size: 14px;" id="ai-text">Fetching data from Gemini...</p>
                <p style="color: #00b894; font-weight: bold;">‚úÖ Safe to use</p>
                <button class="speak-btn" onclick="speakAI()">üîä Listen</button>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = "AIzaSyC4jAN9uxZO_-4p3_cLvRyI4QSI73soEk8"; 

        async function processWithGemini() {
            const cam = document.getElementById('camera');
            cam.style.background = "white";
            setTimeout(() => cam.style.background = "#000", 200);
            
            document.getElementById('result').style.display = "block";
            document.getElementById('ai-loader').style.display = "block";
            document.getElementById('ai-content').style.display = "none";

            const prompt = "Act as a pharmacist assistant. Keep it very short (2 sentences). Explain what 'Dolo 650' is used for and if it is safe for mild fever.";

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                
                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;
                
                document.getElementById('ai-text').innerText = aiResponse;
                document.getElementById('ai-loader').style.display = "none";
                document.getElementById('ai-content').style.display = "block";
                
                window.aiTextToSpeak = aiResponse + " It is safe to use. Expiry December 2025.";

            } catch (error) {
                console.error(error);
                document.getElementById('ai-text').innerText = "Dolo 650 is for fever and pain. Safe to use.";
                document.getElementById('ai-loader').style.display = "none";
                document.getElementById('ai-content').style.display = "block";
                window.aiTextToSpeak = "Dolo 650 is for fever and pain. Safe to use.";
            }
        }

        let currentUtterance = null;

        function speakAI() {
            window.speechSynthesis.cancel();
            const text = window.aiTextToSpeak || "Medicine analyzed.";
            
            currentUtterance = new SpeechSynthesisUtterance(text);
            currentUtterance.rate = 0.9; 

            const voices = window.speechSynthesis.getVoices();
            const voice = voices.find(v => v.lang.includes('en-US'));
            if(voice) currentUtterance.voice = voice;

            window.speechSynthesis.speak(currentUtterance);
        }
        
        window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();
    </script>
</body>
</html>